define("ndi/material/0.1.0/material",["ndi/render/0.58.0/render","ndi/loader/0.1.0/loader","ndi/events/0.1.0/events","ndi/math/0.1.0/math","ndi/map/0.1.0/map"],function(a,b,d){function e(a){for(attr in j)a[attr]=void 0===a[attr]?j[attr].default:a[attr]}function f(a,b,c){if("object"==typeof this&&!(this instanceof f))return new f(a,b,c);this.app=b,this.callback=c,this.id=a.id,this.id||console.error("ID 不得为空！");var d=RegExp(b.get("yunid")).test(this.id);this.render=null,this.loaded=!1,this.basic=null,this.lambert=null,this.phong=null,this.attributes={},this.__maps__={},this.__init__(),d?this.yun():this.val(a)}var g=a("ndi/render/0.58.0/render"),h=a("ndi/loader/0.1.0/loader"),i=a("ndi/math/0.1.0/math");a("ndi/map/0.1.0/map"),g.Material.prototype.val=function(){var a={},b=this;return Object.keys(this).forEach(function(c){if(j.hasOwnProperty(c)){var d,e=j[c].setType;switch(e){case"value":d=b[c];break;case"map":var f=b[c];f&&(d=f.sourceFile);break;case"const":d=b.constName(c);break;case"color":case"vec2":case"vec3":d=b[c].val();break;case"envMap":}a[c]=d}}),a.id=a.id||a.name,a},g.Material.prototype.constName=function(a){var b=this[a],d=j[a].constant;for(c in d)if(d[c]===b)return c},f.prototype.__init__=function(){this.basic=new g.MeshBasicMaterial,this.lambert=new g.MeshLambertMaterial,this.phong=new g.MeshPhongMaterial},f.prototype.yun=function(){var a=new h({url:this.app.get("yunHost")+"/material/"+this.id}),b=this;a.on("complete",function(a){b.val(a.data)}),a.load()},f.prototype.switchRender=function(a){switch(a){case"basic":this.render=this.basic;break;case"lambert":this.render=this.lambert;break;case"phong":this.render=this.phong;break;default:this.render=this.phong}},f.prototype.constName=function(a){var b=this.attributes[a],d=j[a].constant;for(c in d)if(d[c]===b)return c},f.prototype.val=function(a){this.attributes;var b=this;if(void 0===a){var c={};return Object.keys(j).forEach(function(a){c[a]=b.get(a)}),c}e(a),this.set(a,!0),this.createMaps()},f.prototype.get=function(a){return this.attributes[a]},f.prototype.set=function(a,b,c){if("object"==typeof a)for(n in a)this.set(n,a[n],b);else{if(!j.hasOwnProperty(a))return this;var d,e=j[a].setType;switch(e){case"value":case"render":d=b;break;case"map":b&&(this.__maps__[a]=b);break;case"const":d=j[a].constant[b];break;case"color":d=i.num2color(b);break;case"envMap":break;case"vec2":d=i.arr2vec2(b);break;case"vec3":d=i.arr2vec3(b)}"render"===e?this.switchRender(d):"map"===e?c||this.createMaps():(this.basic[a]=d,this.lambert[a]=d,this.phong[a]=d),this.attributes[a]=b}return this},f.prototype.createMaps=function(){var a=this.app,b=this,c=this.__maps__;a.async.eachLimit(Object.keys(c),1,function(d,e){var f=c[d];"string"==typeof f?f={id:f}:f.id=f._id,a.map(f,function(a,c){var f=c.map.render;b.basic[d]=f,b.lambert[d]=f,b.phong[d]=f,b.basic.needsUpdate=!0,b.lambert.needsUpdate=!0,b.phong.needsUpdate=!0,e(null,f)})},function(){b.loaded||(b.callback(b),b.loaded=!0)})},f.config=[{name:"name",cname:"名称",type:"string","default":"",setType:"value"},{name:"side",cname:"面",type:"select","default":"front",setType:"const",options:[{name:"正面",value:"front"},{name:"反面",value:"back"},{name:"双面",value:"double"}],constant:{front:g.FrontSide,back:g.BackSide,"double":g.DoubleSide}},{name:"opacity",cname:"透明度",type:"number","default":1,setType:"value",min:0,max:1},{name:"transparent",cname:"透明",type:"boolean","default":!1,setType:"value"},{name:"blending",cname:"混合选项",type:"select","default":"normal",setType:"const",options:[{name:"无",value:"no"},{name:"正常",value:"normal"},{name:"叠加",value:"additive"},{name:"差值",value:"subtractive"},{name:"multiply",value:"multiply"},{name:"custom",value:"custom"}],constant:{no:g.NoBlending,normal:g.NormalBlending,additive:g.AdditiveBlending,subtractive:g.SubtractiveBlending,multiply:g.MultiplyBlending,custom:g.CustomBlending}},{name:"blendSrc",cname:"混合Src",type:"select","default":"srcAlpha",setType:"const",options:[{name:"zero",value:"zero"},{name:"one",value:"one"},{name:"srcColor",value:"srcColor"},{name:"oneMinusSrcColor",value:"oneMinusSrcColor"},{name:"srcAlpha",value:"srcAlpha"},{name:"oneMinusSrcAlpha",value:"oneMinusSrcAlpha"},{name:"dstAlpha",value:"dstAlpha"},{name:"oneMinusDstAlpha",value:"oneMinusDstAlpha"},{name:"dstColor",value:"dstColor"},{name:"oneMinusDstColor",value:"oneMinusDstColor"},{name:"srcAlphaSaturate",value:"srcAlphaSaturate"}],constant:{zero:g.ZeroFactor,one:g.OneFactor,srcColor:g.SrcColorFactor,oneMinusSrcColor:g.OneMinusSrcColorFactor,srcAlpha:g.SrcAlphaFactor,oneMinusSrcAlpha:g.OneMinusSrcAlphaFactor,dstAlpha:g.DstAlphaFactor,oneMinusDstAlpha:g.OneMinusDstAlphaFactor,dstColor:g.DstColorFactor,oneMinusDstColor:g.OneMinusDstColorFactor,srcAlphaSaturate:g.SrcAlphaSaturateFactor}},{name:"blendEquation",cname:"混合方程式",type:"select","default":"add",setType:"const",options:[{name:"add",value:"add"},{name:"reverseSubtract",value:"reverseSubtract"},{name:"subtract",value:"subtract"}],constant:{add:g.AddEquation,reverseSubtract:g.ReverseSubtractEquation,subtract:g.SubtractEquation}},{name:"depthTest",cname:"深度测试",type:"boolean","default":!0,setType:"value",children:[{name:"depthWrite",cname:"深度写入",type:"boolean","default":!0,setType:"value"}]},{name:"alphaTest",cname:"透明测试",type:"number","default":0,setType:"value",min:0,max:1},{name:"polygonOffset",cname:"多边形偏移",type:"boolean","default":!1,setType:"value",children:[{name:"polygonOffsetFactor",cname:"多边形偏移因素",type:"number","default":0,setType:"value"},{name:"polygonOffsetUnits",cname:"多边形偏移单位",type:"number","default":0,setType:"value"}]},{name:"visible",cname:"可视",type:"boolean","default":!0,setType:"value"},{name:"renderType",cname:"渲染类型",type:"select","default":"phong",setType:"render",options:[{name:"基础",value:"basic"},{name:"普通",value:"lambert"},{name:"质感",value:"phong"}],children:[{name:"color",cname:"颜色",type:"color","default":16777215,setType:"color"},{name:"map",cname:"贴图",type:"map","default":null,setType:"map"},{name:"lightMap",cname:"灯光图",type:"map","default":null,setType:"map"},{name:"specularMap",cname:"高光图",type:"map","default":null,setType:"map"},{name:"envMap",cname:"环境贴图",type:"envMap","default":null,setType:"envMap"},{name:"combine",cname:"combine",type:"select","default":"multiply",setType:"const",options:[{name:"multiply",value:"multiply"},{name:"mix",value:"mix"},{name:"add",value:"add"}],constant:{multiply:g.MultiplyOperation,mix:g.MixOperation,add:g.AddOperation}},{name:"reflectivity",cname:"反射",type:"number","default":1,setType:"value"},{name:"refractionRatio",cname:"折光率",type:"number","default":.98,setType:"value"},{name:"fog",cname:"雾",type:"boolean","default":!0,setType:"value"},{name:"shading",cname:"阴影",type:"select","default":"smooth",setType:"const",options:[{name:"no",value:"no"},{name:"flat",value:"flat"},{name:"smooth",value:"smooth"}],constant:{no:g.NoShading,flat:g.FlatShading,smooth:g.SmoothShading}},{name:"wireframe",cname:"线框",type:"boolean","default":!1,setType:"value",children:[{name:"wireframeLinewidth",cname:"线框宽度",type:"number","default":1,setType:"value",min:0,max:100},{name:"wireframeLinecap",cname:"wireframeLinecap",type:"string","default":"round",setType:"value"},{name:"wireframeLinejoin",cname:"wireframeLinejoin",type:"string","default":"round",setType:"value"}]},{name:"vertexColors",cname:"顶点颜色",type:"select","default":"no",setType:"const",options:[{name:"no",value:"no"},{name:"face",value:"face"},{name:"vertex",value:"vertex"}],constant:{no:g.NoColors,face:g.FaceColors,vertex:g.VertexColors}},{name:"skinning",cname:"skinning",type:"boolean","default":!1,setType:"value"},{name:"morphTargets",cname:"morphTargets",type:"boolean","default":!1,setType:"value"},{name:"ambient",cname:"环境光",type:"color","default":16777215,setType:"color"},{name:"emissive",cname:"反射光",type:"color","default":0,setType:"color"},{name:"wrapAround",cname:"wrapAround",type:"boolean","default":!1,setType:"value",children:[{name:"wrapRGB",cname:"wrapRGB",type:"array","default":[1,1,1],setType:"vec3"}]},{name:"morphNormals",cname:"morphNormals",type:"boolean","default":!1,setType:"value"},{name:"specular",cname:"高光",type:"color","default":1118481,setType:"color"},{name:"shininess",cname:"光泽度",type:"number","default":30,setType:"value",min:0,max:100},{name:"metal",cname:"金属质感",type:"boolean","default":!1,setType:"value"},{name:"perPixel",cname:"perPixel",type:"boolean","default":!0,setType:"value"},{name:"bumpMap",cname:"bumpMap",type:"map","default":null,setType:"map",children:[{name:"bumpScale",cname:"bumpScale",type:"number","default":1,setType:"value"}]},{name:"normalMap",cname:"法线图",type:"map","default":null,setType:"map",children:[{name:"normalScale",cname:"法线图尺寸",type:"array","default":[1,1],setType:"vec2"}]}]}];var j=f.config.hash={};!function l(a){a.forEach(function(a){j[a.name]=a,a.children&&a.children.length&&l(a.children)})}(f.config);var k=f.config.matAttrs={};k.mat=["side","opacity","transparent","blending","blendSrc","blendDst","blendEquation","depthTest","depthWrite","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","alphaTest","overdraw","visible"],k.basic=["color","map","lightMap","specularMap","envMap","combine","reflectivity","refractionRatio","fog","shading","wireframe","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","vertexColors","skinning","morphTargets"],k.lambert=["ambient","emissive","wrapAround","wrapRGB","morphNormals"].concat(k.basic),k.phong=["specular","shininess","metal","perPixel","bumpMap","bumpScale","normalMap","normalScale"].concat(k.lambert),d.exports=f});
