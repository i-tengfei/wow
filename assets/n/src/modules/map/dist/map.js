define("ndi/map/0.1.0/map",["ndi/render/0.58.0/render","ndi/loader/0.1.0/loader","ndi/events/0.1.0/events","ndi/math/0.1.0/math"],function(a,b,d){function e(a){for(attr in j)a[attr]=void 0===a[attr]?j[attr].default:a[attr]}function f(a,b,c){if("object"==typeof this&&!(this instanceof f))return new f(a,b,c);this.app=b,this.callback=c,this.id=a.id,this.id||console.error("ID 不得为空！");var d=RegExp(b.get("yunid")).test(this.id);this.render=null,this.loaded=!1,this.attributes={},this.val(a),d&&this.yun()}var g=a("ndi/render/0.58.0/render"),h=a("ndi/loader/0.1.0/loader"),i=a("ndi/math/0.1.0/math");f.prototype.__init__=function(){var a,b=this.attributes,c=this,d=new Image;d.src=b.image,d.onload=function(){a.needsUpdate=!0,c.loaded||(c.callback(c),c.loaded=!0)},a=new g.Texture(d,this.getTextureValue("mapping"),this.getTextureValue("wrapS"),this.getTextureValue("wrapT"),this.getTextureValue("magFilter"),this.getTextureValue("minFilter"),this.getTextureValue("format"),this.getTextureValue("type"),this.getTextureValue("anisotropy")),a.name=this.getTextureValue("name"),a.mipmaps=this.getTextureValue("mipmaps"),a.offset=this.getTextureValue("offset"),a.repeat=this.getTextureValue("repeat"),a.generateMipmaps=this.getTextureValue("generateMipmaps"),a.premultiplyAlpha=this.getTextureValue("premultiplyAlpha"),a.flipY=this.getTextureValue("flipY"),a.unpackAlignment=this.getTextureValue("unpackAlignment"),a.sourceFile=this.getTextureValue("sourceFile"),this.render=a},f.prototype.yun=function(){var a=new h({url:this.app.get("yunHost")+"/map/"+this.id}),b=this;a.on("complete",function(a){b.val(a.data)}),a.load()},f.prototype.val=function(a){var b=this;if(this.attributes,void 0===a){var c={};return Object.keys(j).forEach(function(a){c[a]=b.get(a)}),c}e(a),this.set(a),this.__init__()},f.prototype.get=function(a){return this.attributes[a]},f.prototype.getTextureValue=function(a){var b,c=j[a].setType;switch(c){case"value":case"image":b=this.get(a);break;case"const":b=j[a].constant[this.get(a)];break;case"newConst":b=new(j[a].constant[this.newConstName(a)]);break;case"vec2":b=i.arr2vec2(this.get(a))}return b},f.prototype.set=function(a,b){if("object"==typeof a)for(n in a)this.set(n,a[n]);else{if(!j.hasOwnProperty(a))return this;var c,d=j[a].setType;switch(d){case"value":case"image":c=b;break;case"const":c=j[a].constant[b];break;case"newConst":c=new(j[a].constant[this.newConstName(a)]);break;case"vec2":c=i.arr2vec2(b)}var e=this.render;e&&(e.image&&"image"===d?e.image.src=c:(e[a]=c,e.needsUpdate=!0)),this.attributes[a]=b}return this},f.prototype.constName=function(a){var b=this.attributes[a],d=j[a].constant;for(c in d)if(d[c]===b)return c},f.prototype.newConstName=function(a){var b=this.attributes[a],d=j[a].constant;for(c in d)if(b instanceof d[c])return c;return j[a].default},f.config=[{name:"name",cname:"名称","default":"",type:"string",setType:"value"},{name:"image",cname:"图片","default":"",type:"image",setType:"image"},{name:"mipmaps",cname:"mipmaps","default":[],type:"array",setType:"value"},{name:"mapping",cname:"mapping","default":"uv",type:"select",setType:"newConst",constant:{uv:g.UVMapping,cubeReflection:g.CubeReflectionMapping,cubeRefraction:g.CubeRefractionMapping,sphericalReflection:g.SphericalReflectionMapping,sphericalRefraction:g.SphericalRefractionMapping},options:[{name:"uv",value:"uv"},{name:"cubeReflection",value:"cubeReflection"},{name:"cubeRefraction",value:"cubeRefraction"},{name:"sphericalReflection",value:"sphericalReflection"},{name:"sphericalRefraction",value:"sphericalRefraction"}]},{name:"wrapS",cname:"wrapS","default":"clampToEdge",type:"select",setType:"const",constant:{repeat:g.RepeatWrapping,clampToEdge:g.ClampToEdgeWrapping,mirroredRepeat:g.MirroredRepeatWrapping},options:[{name:"repeat",value:"repeat"},{name:"clampToEdge",value:"clampToEdge"},{name:"mirroredRepeat",value:"mirroredRepeat"}]},{name:"wrapT",cname:"wrapT","default":"clampToEdge",type:"select",setType:"const",constant:{repeat:g.RepeatWrapping,clampToEdge:g.ClampToEdgeWrapping,mirroredRepeat:g.MirroredRepeatWrapping},options:[{name:"repeat",value:"repeat"},{name:"clampToEdge",value:"clampToEdge"},{name:"mirroredRepeat",value:"mirroredRepeat"}]},{name:"magFilter",cname:"magFilter","default":"linear",type:"select",setType:"const",constant:{nearest:g.NearestFilter,nearestMipMapNearest:g.NearestMipMapNearestFilter,nearestMipMapLinear:g.NearestMipMapLinearFilter,linear:g.LinearFilter,linearMipMapNearest:g.LinearMipMapNearestFilter,linearMipMapLinear:g.LinearMipMapLinearFilter},options:[{name:"nearest",value:"nearest"},{name:"nearestMipMapNearest",value:"nearestMipMapNearest"},{name:"nearestMipMapLinear",value:"nearestMipMapLinear"},{name:"linear",value:"linear"},{name:"linearMipMapNearest",value:"linearMipMapNearest"},{name:"linearMipMapLinear",value:"linearMipMapLinear"}]},{name:"minFilter",cname:"minFilter","default":"linearMipMapLinear",type:"select",setType:"const",constant:{nearest:g.NearestFilter,nearestMipMapNearest:g.NearestMipMapNearestFilter,nearestMipMapLinear:g.NearestMipMapLinearFilter,linear:g.LinearFilter,linearMipMapNearest:g.LinearMipMapNearestFilter,linearMipMapLinear:g.LinearMipMapLinearFilter},options:[{name:"nearest",value:"nearest"},{name:"nearestMipMapNearest",value:"nearestMipMapNearest"},{name:"nearestMipMapLinear",value:"nearestMipMapLinear"},{name:"linear",value:"linear"},{name:"linearMipMapNearest",value:"linearMipMapNearest"},{name:"linearMipMapLinear",value:"linearMipMapLinear"}]},{name:"anisotropy",cname:"anisotropy","default":1,type:"number",setType:"value"},{name:"format",cname:"格式","default":"RGBA",type:"select",setType:"const",constant:{alpha:g.AlphaFormat,RGB:g.RGBFormat,RGBA:g.RGBAFormat,luminance:g.LuminanceFormat,luminanceAlpha:g.LuminanceAlphaFormat},options:[{name:"alpha",value:"alpha"},{name:"RGB",value:"RGB"},{name:"RGBA",value:"RGBA"},{name:"luminance",value:"luminance"},{name:"luminanceAlpha",value:"luminanceAlpha"}]},{name:"type",cname:"类型","default":"unsignedByte",type:"select",setType:"const",constant:{unsignedByte:g.UnsignedByteType,"byte":g.ByteType,"short":g.ShortType,unsignedShort:g.UnsignedShortType,"int":g.IntType,unsignedInt:g.UnsignedIntType,"float":g.FloatType},options:[{name:"unsignedByte",value:"unsignedByte"},{name:"byte",value:"byte"},{name:"short",value:"short"},{name:"unsignedShort",value:"unsignedShort"},{name:"int",value:"int"},{name:"unsignedInt",value:"unsignedInt"},{name:"float",value:"float"}]},{name:"offset",cname:"偏移","default":[0,0],type:"array",setType:"vec2"},{name:"repeat",cname:"重复","default":[1,1],type:"array",setType:"vec2"},{name:"generateMipmaps",cname:"generateMipmaps","default":!0,type:"boolean",setType:"value"},{name:"premultiplyAlpha",cname:"预乘Alpha","default":!1,type:"boolean",setType:"value"},{name:"flipY",cname:"翻转","default":!0,type:"boolean",setType:"value"},{name:"unpackAlignment",cname:"解压对齐","default":4,type:"number",setType:"value"},{name:"sourceFile",cname:"源文件","default":"",type:"string",setType:"value"}];var j=f.config.hash={};!function k(a){a.forEach(function(a){j[a.name]=a,a.children&&a.children.length&&k(a.children)})}(f.config),d.exports=f});
