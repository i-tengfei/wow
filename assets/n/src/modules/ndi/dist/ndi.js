define("ndi/ndi/0.1.0/ndi",["ndi/render/0.58.0/render","ndi/model/0.1.0/model","ndi/orbit-camera/0.1.0/orbit-camera","ndi/mouse-manager/0.1.0/mouse-manager","ndi/events/0.1.0/events","ndi/key-manager/0.1.0/key-manager","ndi/event-listener/0.1.0/event-listener","ndi/math/0.1.0/math","ndi/material/0.1.0/material","ndi/map/0.1.0/map","ndi/async/0.2.5/async","ndi/tween/0.10.0/tween","ndi/render-extend/0.1.0/render-extend"],function(a,b,c){function e(a){return"object"!=typeof this||this instanceof e?(this.__render__={clock:new f.Clock,scene:new f.Scene},this.__hash__={},this.attributes={},this.canvas=null,this.cameraProxy=null,this.width=window.innerWidth,this.height=window.innerHeight,this.browser=e.browser,this.async=m,this.val(a||{}),this.__init__(),void 0):new e(a)}var f=a("ndi/render/0.58.0/render"),g=a("ndi/model/0.1.0/model"),h=a("ndi/orbit-camera/0.1.0/orbit-camera"),i=a("ndi/math/0.1.0/math"),j=a("ndi/events/0.1.0/events"),k=a("ndi/material/0.1.0/material"),l=a("ndi/map/0.1.0/map"),m=a("ndi/async/0.2.5/async"),n=a("ndi/tween/0.10.0/tween"),o=a("ndi/mouse-manager/0.1.0/mouse-manager");a("ndi/render-extend/0.1.0/render-extend"),e.BEFORE_RENDER="beforeRender",e.RESIZE="resize",e.READY="ready",e.OVER="over",e.async=m,j.mixTo(e),e.prototype.events={},e.prototype.__init__=function(){var a=this.attributes,b=this.__render__.renderer=new f.WebGLRenderer({antialias:a.antialias});if(this.__render__.camera=new f.PerspectiveCamera(45,this.width/this.height,.1,1e5),this.canvas=b.domElement,document.body.appendChild(a.container),a.container.appendChild(this.canvas),a.autoSize&&window.addEventListener("resize",this.resize.bind(this)),this.resize(),a.autoStart&&this.start(),a.userSelect){var c=a.operator.style;c.webkitUserSelect="none",c.mozUserSelect="none",c.msUserSelect="none",c.userSelect="none"}},e.prototype.val=function(a){var b=this.attributes;return void 0===a?{autoRun:b.autoRun,autoSize:b.autoSize,autoStart:b.autoStart,antialias:b.antialias,userSelect:b.userSelect,fullWindow:b.fullWindow,rendererType:"webgl",rendererType:"perspective",container:b.container.id,operator:b.operator.id,yunHost:b.yunHost,yunid:b.yunid}:(b.autoRun=i.check(a.autoRun,!0),b.autoSize=i.check(a.autoSize,!0),b.autoStart=i.check(a.autoStart,!0),b.antialias=i.check(a.antialias,!0),b.userSelect=i.check(a.userSelect,!0),b.fullWindow=i.check(a.fullWindow,!0),b.controlType=a.controlType||"orbit",b.rendererType=a.rendererType||"webgl",b.cameraType=a.cameraType||"perspective",b.container=a.container?document.getElementById(a.container):document.createElement("div"),b.operator=a.operator?document.getElementById(a.operator):b.container,b.yunHost=a.yunHost||"/api",b.yunid=a.yunid||"^[a-z0-9]{24}$",void 0)},e.prototype.setHash=function(a){return this.__hash__[a.id]=a,this},e.prototype.getHash=function(a){return this.__hash__[a]},e.prototype.run=function(a){return this.on(e.BEFORE_RENDER,a),this},e.prototype.stop=function(a){return this.off(e.BEFORE_RENDER,a),this},e.prototype.resize=function(a){if(a&&"function"==typeof a)this.on(e.RESIZE,a);else{var b,c;this.attributes.fullWindow?(b=window.innerWidth,c=window.innerHeight):(b=this.prototype.container.offsetWidth,c=this.prototype.container.offsetHeight),this.__render__.renderer.setSize(b,c),this.__render__.camera.aspect=b/c,this.__render__.camera.updateProjectionMatrix(),this.width=b,this.height=c,this.trigger(e.RESIZE,b,c)}return this},e.prototype.start=function(){return this.render(),this},e.prototype.get=function(a){return this.attributes[a]},e.prototype.render=function(){var a=this.__render__,b=a.camera;this.attributes.autoRun&&requestAnimationFrame(this.render.bind(this));var c=a.clock.getDelta();return this.trigger(e.BEFORE_RENDER,c),n.update(),this.cameraProxy&&(b.position.val(this.cameraProxy.positionWorld),b.rotation.val(this.cameraProxy.rotationWorld)),a.renderer.render(a.scene,b),this},e.prototype.add=function(a){return a instanceof f.Object3D?this.__render__.scene.add(a):a.id?(this.__hash__[a.id]=a,this.__render__.scene.add(a.render)):this.add(a.render),this},e.prototype.enableMouse=function(){return this.mouseManager=this.mouseManager||new o(this.get("operator")),this},e.createAction=function(a,b){e.prototype[a]?console.error("该动作名称已存在！"):e.prototype[a]=function(a,c,e){var f={};"function"==typeof c&&(e=c,c=void 0);var g=a.filter||[];if(c&&"all"===g)f=void 0;else for(d in c)-1===g.indexOf(d)&&(f[d]=c[d]);var h={};if(f&&"all"===a.inherit)for(d in f)h[d]=d;else Array.isArray(a.inherit)?a.inherit.forEach(function(a){h[a]=a}):h=a.inherit;return b.call(this,a,f,function(a){a=a||{};for(d in h)a[h[d]]=f[d];e&&e(null,a)}),this}},e.createAction("cmd",function(a,b,c){var d=a.type||"waterfall",e=this;Array.isArray(a.commands)||("object"==typeof a.commands&&a.commands.action?a.commands=[a.commands]:console.error("commands 不正确！"));var f=a.commands.map(function(a){return function(a,b){var c=a[0].insert;return function(){for(var d=0,f=arguments.length;f>d;d++){if(c&&0===d)for(var g=0,h=c.length;h>g;g++){var i=c[g];a[0][i]=arguments[0][i]}a.push(arguments[d])}e[b].apply(e,a)}}([a.options||{}],a.action)});b&&"waterfall"===d&&f.unshift(function(a){a(null,b)}),m[d](f,function(){c&&c()})}),e.createAction("branch",function(a,b,c){var d=this;a.commands.forEach(function(a){d.cmd(a,b)}),c&&c()}),e.createAction("delay",function(a,b,c){function d(){var c=Math.min(.001*(Date.now()-g),f),h=Math.min(c/f,1),i=Math.floor(c);e.cmd(a.progress,{start:g,end:g+1e3*f,progress:h,current:c,number:i,total:f,rootData:b}),1===h&&e.stop(d)}var e=this,f=a.time||2,g=Date.now();a.progress&&this.run(d),setTimeout(c,1e3*f)}),e.createAction("mesh",function(a,b,c){var d=this;a.renderType="mesh",g(a,this,function(){d.add(this),c&&c({model:this})})}),e.createAction("material",function(a,b,c){var d=this.getHash(a.id),e=this;d?c&&c({material:d}):k(a,this,function(){e.setHash(this),c&&c({material:this})})}),e.createAction("map",function(a,b,c){var d=this.getHash(a.id),e=this;d?c&&c({map:d}):l(a,this,function(){e.setHash(this),c&&c({map:this})})}),e.createAction("camera",function(a,b,c){this.cameraProxy=this.__hash__[a.id]=this.__hash__[a.id]||new h(a,this),c&&c(this.cameraProxy)}),e.createAction("light",function(a,b,c){var d;switch(a.type){case"ambient":d=new f.AmbientLight(a.color||16777215,a.intensity||1);break;case"directional":var d=new f.DirectionalLight(a.color||16777215,a.intensity||1);d.position.val(a.position||[0,0,0])}this.add(d),this.__hash__[a.id]=d,c&&c(d)}),e.createAction("set",function(a,b,c){var d,e=a.id,f=a.values;d="camera"===e?this.cameraProxy:this.__hash__[a.id];for(v in f)d.set(v,f[v]);c&&c()}),e.createAction("animate",function(a,b,c){function d(){var a=this;for(v in g){var b=h[v],c=g[v];c=Array.isArray(c)?c.map(function(c,d){return b[d]+(c-b[d])*a.animate}):b+(c-b)*a.animate,e.set(v,c)}}var e,f=a.id,g=a.values;e="camera"===f?this.cameraProxy:this.__hash__[a.id];var h=e.val();new n.Tween({animate:0}).to({animate:1},1e3*(a.time||1)).easing(n.Easing[a.easing||"Linear"][a.type||"None"]).onUpdate(d).onComplete(function(){c&&c()}).start()}),e.createAction("remove",function(a,b,c){var d=this.getHash(a.id);if(d){var e=d.render;e.parent.remove(e),delete this.__hash__[a.id]}c&&c()}),e.ready=function(){var a=new j;return function(b){"function"==typeof b?a.on("ready",b):a.trigger("ready")}}(),function(){function a(a){var b=window.onload;window.onload="function"!=typeof window.onload?a:function(){b&&b(),a()}}function b(){f||(f=!0,e.ready())}var c=navigator.userAgent.toLowerCase(),d=e.browser={version:(c.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(c),opera:/opera/.test(c),msie:/msie/.test(c)&&!/opera/.test(c),mozilla:/mozilla/.test(c)&&!/(compatible|webkit)/.test(c)},f=!1,g=!1;if(!g){if(g=!0,document.addEventListener&&!d.opera&&document.addEventListener("DOMContentLoaded",b,!1),d.msie&&window==top&&function(){if(!f){try{document.documentElement.doScroll("left")}catch(a){return setTimeout(arguments.callee,0),void 0}b()}}(),d.opera&&document.addEventListener("DOMContentLoaded",function(){if(!f){for(var a=0;a<document.styleSheets.length;a++)if(document.styleSheets[a].disabled)return setTimeout(arguments.callee,0),void 0;b()}},!1),d.safari){var h;!function(){if(!f){if("loaded"!=document.readyState&&"complete"!=document.readyState)return setTimeout(arguments.callee,0),void 0;if(void 0===h){for(var a=document.getElementsByTagName("link"),c=0;c<a.length;c++)"stylesheet"==a[c].getAttribute("rel")&&h++;var d=document.getElementsByTagName("style");h+=d.length}return document.styleSheets.length!=h?(setTimeout(arguments.callee,0),void 0):(b(),void 0)}}()}a(b)}}(),c.exports=e});
